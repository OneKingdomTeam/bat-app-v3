{% extends "dashboard/dashboard.html" %}

{% block body %}
<section class="bat-main-content is-flex pt-6">
    <div class="container">
        {% block body_content %}
        <h2 class="title is-2 has-text-centered">Users</h2>
        {% include "helpers/notification.html" %}
        <div class="is-flex is-justify-content-center">
            <table class="table is-fullwidth vertical-align">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>E-mail</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody class="users-table">
                    {% for user in users %}
                        <tr>
                            <td>
                                {{ user.username }}{% if current_user.user_id == user.user_id %} (you) {% endif %}
                            </td>
                            <td>
                                <a href="mailto:{{ user.email }}">{{ user.email }}</a>
                            </td>
                            <td>
                                {{ user.role.value }}
                            </td>
                            <td class="is-flex is-flex-direction-row has-gap">
                                <a
                                    class="button is-info is-light"
                                    {% if not current_user.can_modify_user(user) %}
                                    disabled
                                    title="You do not have permission to edit this user"
                                    {% else %}
                                    href="{{ url_for("dashboard_users_page") }}/{{ user.user_id }}"
                                    {% endif %}
                                    >
                                    Edit
                                </a>
                                {% if current_user.user_id != user.user_id %}
                                <a
                                    class="button is-danger is-light"
                                    {% if not current_user.can_delete_user(user) %}
                                    disabled
                                    title="You do not have permission to delete this user"
                                    {% else %}
                                    hx-delete="{{ url_for("dashboard_users_page") }}/{{ user.user_id }}"
                                    hx-confirm="Delete user {{ user.username }}?"
                                    hx-select=".bat-body"
                                    hx-target=".bat-body"
                                    hx-push-url="false"
                                    hx-swap="outerHTML"
                                    {% endif %}
                                    >
                                    Delete
                                </button>
                                {% endif %}
                                <div class="message-{{ user.user_id }}"></div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="content pt-5 is-flex is-justify-content-flex-end">
            <a href="{{ url_for("dashboard_user_add_page") }}" hx-boost="true">
                <button class="button is-link">Add User</button>
            </a>
        </div>
    {% endblock %}
    </div>
</section>
{% endblock %}
